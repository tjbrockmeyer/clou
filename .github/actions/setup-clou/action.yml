name: Setup clou
description: Setup the clou binary
inputs: 
  version:
    description: version of the clou binary to use
    required: true
    default: v1.0.0
outputs: {}
runs:
  using: composite
  steps:
    - name: Download and Install clou
      shell: bash
      run: |
        VERSION="${{ inputs.version }}"
        if [[ "$RUNNER_OS" = "Linux" ]]; then
          EXECUTABLE="clou-linux"
        elif [[ "$RUNNER_OS" = "macOS" ]]; then
          EXECUTABLE="clou-macos"
        elif [[ "$RUNNER_OS" = "Windows" ]]; then
          EXECUTABLE="clou-win.exe"
        else
          echo "OS is unsupported: $RUNNER_OS" >&2
          exit 1
        fi
        OUT="$RUNNER_TEMP/clou/clou"
        if [[ "$RUNNER_OS" == "Windows" ]]; then
          dest="${dest}.exe"
        fi
        mkdir "$(dirname "$OUT")"
        URL="https://github.com/tjbrockmeyer/clou/releases/download/$VERSION/$EXECUTABLE"
        echo Installing clou from $URL to $OUT
        curl -L -o "$OUT" "$URL"
        if [[ "$RUNNER_OS" != "Windows" ]]; then
          chmod +x "$OUT"
        fi
        echo "$(dirname "$OUT")" >> $GITHUB_PATH
